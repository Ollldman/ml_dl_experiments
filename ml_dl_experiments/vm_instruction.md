Получение ВМ

Необхдимо получить:

- 1. IP-адрес ВМ;

- 2. Username для подключения (обычно ubuntu);

- 3. SSH ключ для подключения.

1. Сохраните полученный SSH-ключ: 
    - a. В корневой папке вашего компьютера создайте директорию `.ssh`, либо перейдите в неё, если она уже создана. Обычно она расположена по адресу `C:/Users/YourUsername/.ssh/` для `Windows` (`YourUsername` замените на нужное имя пользователя) и `~/.ssh `для MacOS.
    
    - b. Внутри директории создайте файл `user_key` (с расширением txt  для Windows или без расширения для MacOS) и вставьте в него ключ. 

Файл с ключом должен выглядеть так, в конце должна быть пустая строка:

![[SSN]](../ssh.png)

Важно 
Не показывайте ваш приватный ключ никому ни при каких обстоятельствах. 
2. Проверьте подключение к ВМ по SSH. Запустите команду в терминале:
```bash
ssh -i путь/к/ключу ubuntu@ip-адрес
```

# Подключение к ВМ

Для работы над проектом нужно подключиться к ВМ через VSCode, используя расширение Remote - SSH.

Оно позволяет открывать удалённую папку на любом удалённом компьютере, виртуальной машине или контейнере с работающим SSH-сервером и в полной мере использовать функционал среды разработки VS Code. 

Установка Remote - SSH

1) Зайдите в VS Code и выберите слева вкладку Extensions.

2) В поиске введите Remote - SSH.

3) Нажмите Install. Все остальные необходимые расширения, например, 

4) Remote Explorer, установятся автоматически.

![[REMOTE-SSN]](../remote-ssh.png)

# Настройка подключения через Remote - SSH
Теперь подключимся к виртуальной машине по SSH, но уже через VS Code:

1. В VS Code выберите Remote-SSH: Connect to Host... из палитры команд (View → Command Palette).

2. В открывшемся окне введите имя пользователя и ip-адрес виртуальной машины, разделив имя пользователя и адрес символом @. Пример: `ubuntu@89.169.177.120. `

VS Code предложит внести информацию о новом ip-адресе в файл с конфигурациями ssh, достаточно согласиться и добавить к сгенерированной конфигурации путь к файлу с паролем, например: `IdentityFile .ssh/user_key. `

Общий вид конфигурации:

```py
Host ***.***.***.***
  HostName ***.***.***.***
  IdentityFile .ssh/user_key
  User ubuntu
```

3. Если VS Code не определит автоматически определить, что ваша ВМ работает на Linux, он  предложит выбрать тип вручную. Выберите Linux.

4. Через некоторое время VS Code подключится к SSH-серверу и настроит себя. После подключения вы окажетесь в пустом окне. Вы всегда можете  просмотреть строку состояния, чтобы узнать, к какому хосту вы  подключены.

5. Затем вы можете открыть любую папку или рабочую область на удалённой машине, используя File → Open File или File → Open Folder точно так же, как вы делали бы это локально.

# Инструкция по настройке mmdetection-mmsegmentation на VM:

Для начала развертывания MMDetection на виртуальной машине, установим библиотеки из экосистемы OpenMMLab: `mmcv` и `mmengine`.

При использовании `GPU` важно правильно подобрать версии. Для некоторых версий `PyTorch` нет предсобранных версий `MMCV`. В этом случае установщик соберёт `MMCV` из исходников, но получится облегчённая версия без CUDA-операторов, и при работе с `MMSegmentation` будут возникать ошибки. 


Официальная документация указывает, что `MMDetection` поддерживает `PyTorch` с версии 1.8.0. Но важно учитывать комбинацию PyTorch и CUDA, чтобы был пакет MMCV, подходящий под версию PyTorch.

В этом уроке используем проверенный набор:

- PyTorch 2.1.0,
    
- CUDA 12.2.

Теперь установите пакеты `torchvision`, `mmcv` и `mmengine`:
```shell
python3.10 -m pip install --upgrade pip setuptools wheel
pip3.10 install torch==2.1.0+cu121 torchvision==0.16.0+cu121 torchaudio==2.1.0+cu121 --index-url https://download.pytorch.org/whl/cu121

pip3.10 install -U openmim
mim install mmengine
mim install "mmcv==2.1.0" 
```

Далее установите MMDetection в корень вашего проекта:

```shell
// Мы специально делаем понижение версии numpy для корректной установки зависимостей mmdetection
pip3.10 install numpy==1.26.4

git clone https://github.com/open-mmlab/mmdetection.git
cd mmdetection
pip3.10 install . --no-build-isolation
```

Теперь установите дополнительные пакеты, которые могут понадобиться при работе:

```shell
pip3.10 install pyyaml==6.0.1
pip3.10 install opencv-python==4.8.1.78
pip3.10 install seaborn==0.13.2
pip3.10 install ultralytics==8.0.196
pip3.10 install tqdm==4.65.0
pip3.10 install fpdf2==2.7.6
```

Вы установили нужные зависимости. Внутри рабочей директории развернулась библиотека `mmdetection` , и вы можете приступать к выполнению проекта.

Отключение от виртуальной машины
Когда вы закончите работу над проектом, закройте соединение: выберите File → Close remote Connection.